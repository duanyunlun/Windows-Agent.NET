# 2026-02-02：CLI 命令速查（以独立 CLI 工程为主）

## 入口

推荐入口（内部调用现存 Tools）：

- 已安装 dotnet tool（全名）：`windows-agent help`
- 已安装 dotnet tool（简写别名）：`wa help`（需要额外安装 `Windows.Agent.Cli.Alias` 包）
- 从源码运行：`dotnet run --project src/Windows.Agent.Cli/Windows.Agent.Cli.csproj -- help`

> 注意：命令格式固定为 `windows-agent|wa <group> <action> [options]`，`--xxx` 必须放在 `<group> <action>` 之后（否则会被当成 group 解析）。

## 通用参数

- `--pretty`：JSON 美化输出
- `--dangerous`：启用高危命令（默认禁用；涉及桌面交互/写文件/改系统设置/执行命令等）
- `--snapshot-on-error`：失败时尽力采集 `desktop screenshot` + `desktop state` 作为 `artifacts[]`（可能为空）
- `--session <string>`：运行会话 ID（用于日志/证据归档；未指定时 `--snapshot-on-error` 会自动生成）

## 输出说明（独立 CLI 工程）

- CLI 默认输出 JSON 到 stdout，结构固定为：
  - `schemaVersion`：输出结构版本（当前为 `1.0`）
  - `success`：工具语义是否成功（与 exit code 对齐）
  - `code/message`：统一错误码与消息（成功时为 `OK`）
  - `tool`：实际调用的 Tool/方法标识
  - `input`：group/action/options 回显（便于审计与复现）
  - `result.raw`：工具原始输出（字符串）
  - `result.parsed`：若 `raw` 是 JSON，会尝试解析并附带该字段
  - `error`：失败时的错误对象（kind/message 等；CLI 异常时附 stack）
  - `artifacts[]`：失败时自动采集的证据（需 `--snapshot-on-error`）
  - `session`：本次会话 ID

- exit code：成功为 `0`；失败为 `1`（包括：策略拒绝、参数错误、工具语义失败、CLI 异常）。

## Desktop

- `desktop state [--vision true|false]`
- `desktop click --x <int> --y <int> [--button left|right|middle] [--clicks <int>]`
- `desktop type --x <int> --y <int> --text <string> [--clear] [--enter] [--interpretSpecialCharacters]`
- `desktop screenshot`
- `desktop openbrowser [--url <string>] [--search <string>]`
- `desktop scrape --url <string>`
- `desktop powershell --command <string>`
- `desktop launch --name <app>`
- `desktop switch --name <app>`
- `desktop windowinfo --name <app>`
- `desktop resize --name <app> [--width <int>] [--height <int>] [--x <int>] [--y <int>]`
- `desktop move --x <int> --y <int>`
- `desktop drag --startx <int> --starty <int> --endx <int> --endy <int>`
- `desktop scroll [--x <int> --y <int>] [--type vertical|horizontal] [--direction up|down|left|right] [--wheel <int>]`
- `desktop clipboard --mode copy|paste [--text <string>]`
- `desktop wait --seconds <int>`
- `desktop key --key <string>`
- `desktop shortcut --keys <string>`（示例：`ctrl+shift+esc`）
- `desktop ui-find --type text|className|automationId --value <string>`
- `desktop ui-props --x <int> --y <int>`
- `desktop ui-wait --type text|className|automationId --value <string> [--timeoutMs <int>]`
- `desktop uia-tree --window <titleRegex> [--depth <int>] [--backend uia3|uia2]`
- `desktop uia-find --window <titleRegex> --selector <string> [--limit <int>] [--backend uia3|uia2]`
- `desktop uia-invoke --window <titleRegex> --selector <string> [--backend uia3|uia2]`（需要 `--dangerous`）
- `desktop uia-setvalue --window <titleRegex> --selector <string> --value <string> [--backend uia3|uia2]`（需要 `--dangerous`）

## FileSystem

- `fs read --path <string>`
- `fs write --path <string> --content <string> [--append]`
- `fs create --path <string> --content <string>`
- `fs delete --path <string>`
- `fs copy --source <string> --destination <string> [--overwrite]`
- `fs move --source <string> --destination <string> [--overwrite]`
- `fs list --path <string> [--files true|false] [--dirs true|false] [--recursive]`
- `fs mkdir --path <string> [--parents]`
- `fs rmdir --path <string> [--recursive]`
- `fs info --path <string>`
- `fs search-name --directory <string> --pattern <string> [--recursive]`
- `fs search-ext --directory <string> --ext <string> [--recursive]`

## OCR

- `ocr screen`
- `ocr region --x <int> --y <int> --width <int> --height <int>`
- `ocr find --text <string>`
- `ocr coords --text <string>`
- `ocr file --path <string>`

## SystemControl

- `sys volume [--inc|--dec] [--percent <int>] [--mute true|false]`
- `sys brightness [--inc|--dec] [--percent <int>]`
- `sys resolution --type high|medium|low`

## Contract

- `contract validate --path <string>`
- `contract explain --path <string>`

## Diag

- `diag tail-log --path <string> [--lines <int>]`

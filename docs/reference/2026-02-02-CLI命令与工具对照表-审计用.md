# 2026-02-02：CLI 命令与 Tool 功能对照表（审计用）

目的：把当前仓库中**已实现且可通过 CLI 调用**的功能完整列出，便于你逐项审计“功能是否符合要求/是否允许/是否需要加保护策略”。

## 证据来源（可追溯）

- Tool 注册清单：`src/Windows.Agent.Cli/ToolRegistry.cs`
- CLI 命令映射：`src/Windows.Agent.Cli/CliDispatcher.cs`
- Tool 实现源码：`src/Windows.Agent/Tools/**`

## CLI 输出结构（统一）

所有 CLI 命令默认输出 JSON 到 stdout：

- `success`：CLI 调度是否成功（注意：Tool 内部失败通常体现在 `result.raw` 或 `result.parsed`）
- `tool`：实际调用的 `namespace.class.method`
- `result.raw`：Tool 原始输出（字符串）
- `result.parsed`：当 `raw` 为 JSON 字符串时，CLI 会尝试解析并输出该字段

> 解析逻辑见：`src/Windows.Agent.Cli/CliDispatcher.cs`（`WriteToolResult`）

## 约定与范围说明（避免误读）

- 仅统计“已在 `src/Windows.Agent.Cli/CliDispatcher.cs` 映射到 CLI 的命令”。
- group 别名：
  - `fs` 与 `filesystem` 等价
  - `sys` 与 `system` 等价
- **危险/风险点**属于安全审计视角下的分析，不代表一定会发生；但它们是客观可能性，应作为“默认禁用/强提醒/白名单/开关”决策依据。

## 命令清单（按 group）

### Desktop（桌面自动化）

说明：本组能力会真实操作桌面（鼠标/键盘/窗口/剪贴板），可能抢焦点、影响当前用户操作。

| 命令（CLI） | Tool 方法（`tool` 字段） | 功能 | 用法示例 | 可能造成的危险/风险点 |
|---|---|---|---|---|
| `desktop state` | `Windows.Agent.Tools.Desktop.StateTool.GetDesktopStateAsync` | 获取桌面状态（可选截图） | `windows-agent desktop state --pretty` | 中：可能包含窗口标题/控件文本/截图等敏感信息（隐私泄露）。 |
| `desktop launch` | `Windows.Agent.Tools.Desktop.LaunchTool.LaunchAppAsync` | 从开始菜单按名称启动应用 | `windows-agent desktop launch --name Notepad` | 高：可启动任意应用；可能触发下载/安装/恶意程序执行；也会抢焦点。 |
| `desktop switch` | `Windows.Agent.Tools.Desktop.SwitchTool.SwitchAppAsync` | 切换并置顶指定应用窗口 | `windows-agent desktop switch --name Notepad` | 中：抢焦点、打断用户；可能导致误输入到错误窗口。 |
| `desktop windowinfo` | `Windows.Agent.Tools.Desktop.GetWindowInfoTool.GetWindowInfoAsync` | 获取指定窗口信息 | `windows-agent desktop windowinfo --name Notepad` | 低：信息收集（窗口标题/尺寸等）；可能暴露隐私。 |
| `desktop resize` | `Windows.Agent.Tools.Desktop.ResizeTool.ResizeAppAsync` | 调整指定应用窗口大小/位置 | `windows-agent desktop resize --name Notepad --width 800 --height 600` | 中：可能改变窗口布局/遮挡内容；影响当前用户操作；多显示器/缩放环境下可能导致窗口位置异常。 |
| `desktop click` | `Windows.Agent.Tools.Desktop.ClickTool.ClickAsync` | 在坐标点击（支持左右中键、多击） | `windows-agent desktop click --x 100 --y 200 --button left --clicks 1` | 高：真实点击可能触发不可逆操作（删除/支付/发送/关闭未保存内容）；抢焦点导致误操作。 |
| `desktop move` | `Windows.Agent.Tools.Desktop.MoveTool.MoveAsync` | 移动鼠标到指定坐标 | `windows-agent desktop move --x 100 --y 200` | 中：影响用户操作与焦点；配合后续 click/type 风险更高。 |
| `desktop drag` | `Windows.Agent.Tools.Desktop.DragTool.DragAsync` | 从起点拖拽到终点 | `windows-agent desktop drag --startx 10 --starty 10 --endx 300 --endy 300` | 高：可能触发文件拖拽移动/删除、窗口布局改变、误触 UI 操作。 |
| `desktop scroll` | `Windows.Agent.Tools.Desktop.ScrollTool.ScrollAsync` | 在坐标滚动（垂直/水平、方向、次数） | `windows-agent desktop scroll --x 100 --y 200 --type vertical --direction down --wheel 3` | 中：可能触发页面跳转/列表选中变化/滚动误触；影响用户。 |
| `desktop type` | `Windows.Agent.Tools.Desktop.TypeTool.TypeAsync` | 在坐标输入文本（可清空、回车、解释特殊字符） | `windows-agent desktop type --x 100 --y 200 --text \"hello\" --enter` | 高：可能向错误窗口输入敏感信息或执行危险命令；`--clear` 可能覆盖内容。 |
| `desktop key` | `Windows.Agent.Tools.Desktop.KeyTool.KeyAsync` | 按一个键（字符串表示） | `windows-agent desktop key --key enter` | 高：可能确认弹窗、提交表单、执行快捷操作。 |
| `desktop shortcut` | `Windows.Agent.Tools.Desktop.ShortcutTool.ShortcutAsync` | 按组合快捷键（用 `+` 分隔） | `windows-agent desktop shortcut --keys \"alt+f4\"` | 高：可能关闭程序/终止任务/触发系统级动作。 |
| `desktop clipboard` | `Windows.Agent.Tools.Desktop.ClipboardTool.ClipboardAsync` | 剪贴板 copy/paste（可写入文本或读取） | `windows-agent desktop clipboard --mode paste --pretty` | 中：读取剪贴板可能泄露敏感信息；写入剪贴板可能覆盖用户内容。 |
| `desktop wait` | `Windows.Agent.Tools.Desktop.WaitTool.WaitAsync` | 等待指定秒数 | `windows-agent desktop wait --seconds 3` | 低：主要是延时；风险较低。 |
| `desktop screenshot` | `Windows.Agent.Tools.Desktop.ScreenshotTool.TakeScreenshotAsync` | 截图并保存到临时目录 | `windows-agent desktop screenshot --pretty` | 中：截图落盘可能包含敏感信息；文件残留风险。 |
| `desktop openbrowser` | `Windows.Agent.Tools.Desktop.OpenBrowserTool.OpenBrowserAsync` | 打开 URL 或以关键词搜索（默认浏览器） | `windows-agent desktop openbrowser --url \"https://example.com\"` | 高：可能打开钓鱼/恶意页面、触发下载；也可能访问内网地址并泄露信息。 |
| `desktop scrape` | `Windows.Agent.Tools.Desktop.ScrapeTool.ScrapeAsync` | 抓取 URL 内容并转换（HTML→Markdown 等） | `windows-agent desktop scrape --url \"https://example.com\" --pretty` | 中：网络访问可能触达内网/敏感地址（SSRF 风险视角）；抓取内容可能含敏感数据。 |
| `desktop powershell` | `Windows.Agent.Tools.Desktop.PowershellTool.ExecuteCommandAsync` | 执行 PowerShell 命令并返回输出 | `windows-agent desktop powershell --command \"Get-Process\"` | 极高：命令执行可读写文件、改系统配置、下载执行、提权；应视为“完全高危能力”。 |
| `desktop ui-find` | `Windows.Agent.Tools.Desktop.UIElementTool.FindElementByTextAsync / FindElementByClassNameAsync / FindElementByAutomationIdAsync` | 按文本/类名/AutomationId 查找 UI 元素 | `windows-agent desktop ui-find --type text --value \"确定\" --pretty` | 中：可枚举 UI 结构与文本（隐私泄露）；为后续点击定位提供能力。 |
| `desktop ui-props` | `Windows.Agent.Tools.Desktop.UIElementTool.GetElementPropertiesAsync` | 获取坐标处 UI 元素属性 | `windows-agent desktop ui-props --x 100 --y 200 --pretty` | 中：可读取 UI 属性/文本（隐私泄露）。 |
| `desktop ui-wait` | `Windows.Agent.Tools.Desktop.UIElementTool.WaitForElementAsync` | 等待元素出现（超时毫秒） | `windows-agent desktop ui-wait --type text --value \"完成\" --timeoutMs 5000 --pretty` | 低：主要是等待与查询；仍可能泄露 UI 文本。 |

对应 Tool 源码（按文件）：

- `src/Windows.Agent/Tools/Desktop/ClickTool.cs`：`ClickTool.ClickAsync(...)`
- `src/Windows.Agent/Tools/Desktop/MoveTool.cs`：`MoveTool.MoveAsync(...)`
- `src/Windows.Agent/Tools/Desktop/DragTool.cs`：`DragTool.DragAsync(...)`
- `src/Windows.Agent/Tools/Desktop/ScrollTool.cs`：`ScrollTool.ScrollAsync(...)`
- `src/Windows.Agent/Tools/Desktop/TypeTool.cs`：`TypeTool.TypeAsync(...)`
- `src/Windows.Agent/Tools/Desktop/KeyTool.cs`：`KeyTool.KeyAsync(...)`
- `src/Windows.Agent/Tools/Desktop/ShortcutTool.cs`：`ShortcutTool.ShortcutAsync(...)`
- `src/Windows.Agent/Tools/Desktop/ClipboardTool.cs`：`ClipboardTool.ClipboardAsync(...)`
- `src/Windows.Agent/Tools/Desktop/WaitTool.cs`：`WaitTool.WaitAsync(...)`
- `src/Windows.Agent/Tools/Desktop/ScreenshotTool.cs`：`ScreenshotTool.TakeScreenshotAsync()`
- `src/Windows.Agent/Tools/Desktop/OpenBrowserTool.cs`：`OpenBrowserTool.OpenBrowserAsync(...)`
- `src/Windows.Agent/Tools/Desktop/ScrapeTool.cs`：`ScrapeTool.ScrapeAsync(...)`
- `src/Windows.Agent/Tools/Desktop/PowershellTool.cs`：`PowershellTool.ExecuteCommandAsync(...)`
- `src/Windows.Agent/Tools/Desktop/StateTool.cs`：`StateTool.GetDesktopStateAsync(...)`
- `src/Windows.Agent/Tools/Desktop/LaunchTool.cs`：`LaunchTool.LaunchAppAsync(...)`
- `src/Windows.Agent/Tools/Desktop/SwitchTool.cs`：`SwitchTool.SwitchAppAsync(...)`
- `src/Windows.Agent/Tools/Desktop/GetWindowInfoTool.cs`：`GetWindowInfoTool.GetWindowInfoAsync(...)`
- `src/Windows.Agent/Tools/Desktop/ResizeTool.cs`：`ResizeTool.ResizeAppAsync(...)`
- `src/Windows.Agent/Tools/Desktop/UIElementTool.cs`：`UIElementTool.*`
- `src/Windows.Agent/Tools/Desktop/LaunchTool.cs`：`LaunchTool.LaunchAppAsync(...)`
- `src/Windows.Agent/Tools/Desktop/SwitchTool.cs`：`SwitchTool.SwitchAppAsync(...)`
- `src/Windows.Agent/Tools/Desktop/GetWindowInfoTool.cs`：`GetWindowInfoTool.GetWindowInfoAsync(...)`
- `src/Windows.Agent/Tools/Desktop/UIElementTool.cs`：`UIElementTool.*`

### FileSystem（文件系统）

说明：本组能力会读写/创建/删除文件与目录，属于强副作用能力（尤其 delete/rmdir）。

| 命令（CLI） | Tool 方法（`tool` 字段） | 功能 | 用法示例 | 可能造成的危险/风险点 |
|---|---|---|---|---|
| `fs read` | `Windows.Agent.Tools.FileSystem.ReadFileTool.ReadFileAsync` | 读取文件内容并输出（JSON） | `windows-agent fs read --path \"C:\\temp\\a.txt\" --pretty` | 高：可读取任意路径文件，存在敏感信息泄露风险（密钥/配置/个人数据）。 |
| `fs write` | `Windows.Agent.Tools.FileSystem.WriteFileTool.WriteFileAsync` | 写入/追加文件内容（JSON） | `windows-agent fs write --path \"C:\\temp\\a.txt\" --content \"hi\"` | 高：覆盖/追加可能造成数据损坏；可写入启动项/脚本等引发持久化风险。 |
| `fs create` | `Windows.Agent.Tools.FileSystem.CreateFileTool.CreateFileAsync` | 创建文件并写入内容（JSON） | `windows-agent fs create --path \"C:\\temp\\b.txt\" --content \"hi\"` | 高：可在任意路径落盘文件；配合 powershell 等可形成链路风险。 |
| `fs delete` | `Windows.Agent.Tools.FileSystem.DeleteFileTool.DeleteFileAsync` | 删除文件（JSON） | `windows-agent fs delete --path \"C:\\temp\\a.txt\"` | 极高：不可逆删除（除非回收站/备份）；误删系统文件会导致系统/应用异常。 |
| `fs copy` | `Windows.Agent.Tools.FileSystem.CopyFileTool.CopyFileAsync` | 拷贝文件（可选覆盖）（JSON） | `windows-agent fs copy --source a.txt --destination b.txt --overwrite` | 高：覆盖可能破坏目标；可复制敏感文件到可外传位置。 |
| `fs move` | `Windows.Agent.Tools.FileSystem.MoveFileTool.MoveFileAsync` | 移动文件（可选覆盖）（JSON） | `windows-agent fs move --source a.txt --destination b.txt --overwrite` | 极高：移动/覆盖可能导致数据丢失；移动系统文件可能破坏应用/系统。 |
| `fs info` | `Windows.Agent.Tools.FileSystem.GetFileInfoTool.GetFileInfoAsync` | 获取文件/目录信息（JSON） | `windows-agent fs info --path \"C:\\temp\\\" --pretty` | 中：可探测文件结构与元信息（信息收集）。 |
| `fs list` | `Windows.Agent.Tools.FileSystem.ListDirectoryTool.ListDirectoryAsync` | 列目录（可递归）（JSON） | `windows-agent fs list --path \"C:\\temp\" --recursive --pretty` | 中：递归遍历可能泄露目录结构；对大目录可能性能开销大。 |
| `fs mkdir` | `Windows.Agent.Tools.FileSystem.CreateDirectoryTool.CreateDirectoryAsync` | 创建目录（支持 parents）（JSON） | `windows-agent fs mkdir --path \"C:\\temp\\x\" --parents` | 中：可创建任意目录；风险主要是落盘面扩大。 |
| `fs rmdir` | `Windows.Agent.Tools.FileSystem.DeleteDirectoryTool.DeleteDirectoryAsync` | 删除目录（可递归）（JSON） | `windows-agent fs rmdir --path \"C:\\temp\\x\" --recursive` | 极高：递归删除不可逆；误删将导致大量数据丢失。 |
| `fs search-name` | `Windows.Agent.Tools.FileSystem.SearchFilesTool.SearchFilesByNameAsync` | 按通配符搜索文件名（JSON） | `windows-agent fs search-name --directory \"C:\\temp\" --pattern \"*.log\" --recursive --pretty` | 中：可用于定位敏感文件；递归搜索可能性能开销大。 |
| `fs search-ext` | `Windows.Agent.Tools.FileSystem.SearchFilesTool.SearchFilesByExtensionAsync` | 按扩展名搜索文件（JSON） | `windows-agent fs search-ext --directory \"C:\\temp\" --ext \".log\" --recursive --pretty` | 中：同上（信息收集/性能开销）。 |

对应 Tool 源码（按文件）：

- `src/Windows.Agent/Tools/FileSystem/ReadFileTool.cs`：返回 JSON（`success/content/message/path/contentLength`）
- `src/Windows.Agent/Tools/FileSystem/WriteFileTool.cs`：返回 JSON（`success/message/path/contentLength/append`）
- `src/Windows.Agent/Tools/FileSystem/CreateFileTool.cs`：返回 JSON（`success/message/path/contentLength`）
- `src/Windows.Agent/Tools/FileSystem/DeleteFileTool.cs`、`CopyFileTool.cs`、`MoveFileTool.cs`、`GetFileInfoTool.cs`、`ListDirectoryTool.cs`、`CreateDirectoryTool.cs`、`DeleteDirectoryTool.cs`、`SearchFilesTool.cs`

### OCR（文字识别）

说明：本组能力会截图/读取文件并进行 OCR，可能消耗 CPU/GPU/模型资源。

| 命令（CLI） | Tool 方法（`tool` 字段） | 功能 | 用法示例 | 可能造成的危险/风险点 |
|---|---|---|---|---|
| `ocr screen` | `Windows.Agent.Tools.OCR.ExtractTextFromScreenTool.ExtractTextFromScreenAsync` | 全屏 OCR 提取文本（JSON） | `windows-agent ocr screen --pretty` | 中：截图+文字提取可能暴露敏感信息（验证码/聊天/密钥）；计算开销。 |
| `ocr region` | `Windows.Agent.Tools.OCR.ExtractTextFromRegionTool.ExtractTextFromRegionAsync` | 区域 OCR 提取文本（JSON） | `windows-agent ocr region --x 0 --y 0 --width 300 --height 200 --pretty` | 中：同上；错误区域可能包含隐私。 |
| `ocr find` | `Windows.Agent.Tools.OCR.FindTextOnScreenTool.FindTextOnScreenAsync` | 在屏幕上查找文本是否存在（JSON） | `windows-agent ocr find --text \"确定\" --pretty` | 中：截图分析可能泄露隐私；可用于定位并配合 click 形成自动化链路。 |
| `ocr coords` | `Windows.Agent.Tools.OCR.GetTextCoordinatesTool.GetTextCoordinatesAsync` | 获取指定文本在屏幕上的坐标（JSON） | `windows-agent ocr coords --text \"确定\" --pretty` | 中：同上；提供定位坐标后可用于点击自动化。 |
| `ocr file` | `Windows.Agent.Tools.OCR.ExtractTextFromFileTool.ExtractTextFromFileAsync` | 从图片文件 OCR 提取文本（JSON） | `windows-agent ocr file --path \"C:\\temp\\a.png\" --pretty` | 高：可读取任意图片文件并提取其中敏感信息；文件访问权限同用户权限。 |

对应 Tool 源码（按文件）：

- `src/Windows.Agent/Tools/OCR/ExtractTextFromScreenTool.cs`：返回 JSON（`success/text/message`）
- `src/Windows.Agent/Tools/OCR/ExtractTextFromRegionTool.cs`：返回 JSON（`success/text/message/region`）
- `src/Windows.Agent/Tools/OCR/FindTextOnScreenTool.cs`：返回 JSON（`success/found/searchText/message`）
- `src/Windows.Agent/Tools/OCR/GetTextCoordinatesTool.cs`
- `src/Windows.Agent/Tools/OCR/ExtractTextFromFileTool.cs`

### SystemControl（系统控制）

说明：本组能力会修改系统状态（音量/亮度/分辨率）。**CLI 不会自动还原**，仅测试中有“尽最大努力恢复”的策略。

| 命令（CLI） | Tool 方法（`tool` 字段） | 功能 | 用法示例 | 可能造成的危险/风险点 |
|---|---|---|---|---|
| `sys volume` | `Windows.Agent.Tools.SystemControl.VolumeTool.GetCurrentVolumeAsync / SetMuteStateAsync / SetVolumePercentAsync / SetVolumeAsync` | 读取/设置音量与静音（无参数=读取） | `windows-agent sys volume --percent 30` | 中：打断用户体验；静音/大音量可能影响会议/录音；当前 CLI 不会自动恢复。 |
| `sys brightness` | `Windows.Agent.Tools.SystemControl.BrightnessTool.GetCurrentBrightnessAsync / SetBrightnessPercentAsync / SetBrightnessAsync` | 读取/设置屏幕亮度（无参数=读取） | `windows-agent sys brightness --percent 50` | 中：影响可用性与视觉舒适度；部分设备可能不支持导致异常；当前 CLI 不会自动恢复。 |
| `sys resolution` | `Windows.Agent.Tools.SystemControl.ResolutionTool.SetResolutionAsync` | 设置分辨率（high/medium/low） | `windows-agent sys resolution --type high` | 高：可能导致屏幕显示异常/比例错乱/远程会话问题；需要人工恢复；当前 CLI 不会自动恢复。 |

对应 Tool 源码（按文件）：

- `src/Windows.Agent/Tools/SystemControl/VolumeTool.cs`：`SetVolumeAsync / SetVolumePercentAsync / GetCurrentVolumeAsync / SetMuteStateAsync`
- `src/Windows.Agent/Tools/SystemControl/BrightnessTool.cs`：`SetBrightnessAsync / SetBrightnessPercentAsync / GetCurrentBrightnessAsync`
- `src/Windows.Agent/Tools/SystemControl/ResolutionTool.cs`：`SetResolutionAsync`

## 审计建议（你可以直接在此表上打勾/标注）

建议你逐项审计并给出允许策略（默认允许/需显式开关/完全禁用）：

1. 极高：`desktop powershell`、`fs delete`、`fs rmdir`、`fs move`（含 overwrite）
2. 高：其余桌面交互（click/type/shortcut/drag 等）、`desktop openbrowser`、`fs write/create/copy`
3. 中：截图/OCR、目录遍历、系统音量/亮度/分辨率
4. 低：wait、只读窗口信息
